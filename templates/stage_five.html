
{% extends "base.html" %}
{% block title %}IPND Stage 5 Notes{% endblock %}
{% block content %}
	<h1>IPND Notes Stage 5: Choose Your Next Steps</h1>
	<div class="sidebar">
		<h2>Navigation</h2>
		<div id="accordion">

			<h3>Stage 5.1</h3>
			<div>
			<a href="#stage-5-1"><strong>Meet JavaScript</strong></a>
				<ol>
					<li><a href="#stage-5-1-1">Introduction to JavaScript</a></li>
					<li><a href="#stage-5-1-2">Adding JavaScript to a Page</a></li>
					<li><a href="#stage-5-1-3">var loveJS = true;</a></li>
					<li><a href="#stage-5-1-4">string.replace()</a></li>
					<li><a href="#stage-5-1-5">Mixing .replace() and .append()</a></li>
					<li><a href="#stage-5-1-6">String Manipulation</a></li>
					<li><a href="#stage-5-1-7">Truthy/Falsy</a></li>
					<li><a href="#stage-5-1-8">Arrays</a></li>
					<li><a href="#stage-5-1-9">Array Manipulation</a></li>
					<li><a href="#stage-5-1-10">Object Literal Notation</a></li>
					<li><a href="#stage-5-1-11">Dot and Bracket Notation</a></li>
					<li><a href="#stage-5-1-12">A Note about JSON</a></li>
					<li><a href="#stage-5-1-13">JSON</a></li>
					<li><a href="#stage-5-1-14">Validating JSON</a></li>
				</ol></div>

			<h3>Stage 5.2</h3>
			<div>
			<a href="#stage-5-2"><strong>The Power of APIs</strong></a>
				<ol>
					<li><a href="#stage-5-2-1">Introduction</a></li>
					<li><a href="#stage-5-2-2">HTTP Clients</a></li>
					<li><a href="#stage-5-2-3">Urllib</a></li>
					<li><a href="#stage-5-2-4">XML</a></li>
					<li><a href="#stage-5-2-5">Parsing XML</a></li>
					<li><a href="#stage-5-2-6">JSON</a></li>
					<li><a href="#stage-5-2-7">APIs</a></li>
					<li><a href="#stage-5-2-8">Being a Good Citizen</a></li>
					<li><a href="#stage-5-2-9">SOAP</a></li>
					<li><a href="#stage-5-2-10">ASCII Chan 2</a></li>
					<li><a href="#stage-5-2-11">Geolocation</a></li>
					<li><a href="#stage-5-2-12">Debugging</a></li>
					<li><a href="#stage-5-2-13">Updating the Database</a></li>
					<li><a href="#stage-5-2-14">Querying Coordinate Information</a></li>
					<li><a href="#stage-5-2-15">Creating the Image URL</a></li>
					<li><a href="#stage-5-2-16">Putting it All Together</a></li>
					<li><a href="#stage-5-2-17">Final Code</a></li>
				</ol></div>

		</div><!--accordion div-->
	</div><!--sidebar div-->




	<div class="stage">

	<div class="lesson" id="stage-5-1">
		<h2>Stage 5.1 Meet JavaScript</h2>

		<div class="concept" id="stage-5-1-1">
			<div class="concept-title">Introduction to JavaScript</div>
			<div class="concept-content"><p>This lesson is here for two reasons:</p>
			<p>1. To introduce JavaScript, the programming language of the web.</p>
			<p>2. To quickly refresh and review programming concepts like variables and data types.</p>
			<p>The instructions say that we're free to browse this lesson however we'd like. We can follow along or just watch the videos because the end goal is awareness.</p>
			<p>I like to follow along with the examples the instructors are using because it increases my comprehension and retention. I had trouble at first because the lesson never explicitly says what we are supposed to be editing and what file we are supposed to be looking at in the browser. I posted to the Udacity forums and found out some important things:</p>
			<p>To follow along, you first need to clone the repository at <a target="_blank" href="https://github.com/udacity/frontend-nanodegree-resume">https://github.com/udacity/frontend-nanodegree-resume</a>. If you need help doing that, I recommend the Udacity course <a target="_blank" href="https://www.udacity.com/course/how-to-use-git-and-github--ud775">How to Use Git and GitHub</a>. The course says it takes three weeks but I completed it in about 8 hours, so it won't take very long. Plus, Git is incredibly useful at this point in the Nanodegree as you make major experimental changes in your final project.</p>
			<p>Second, when the instructors have you input code, input it into the <code>resumeBuilder.js</code> file found in your newly cloned repository. The file we should be viewing in the browser for output is the <code>index.html</code> file found in the root directory of the repository.</p></div>
		</div>

		<div class="concept" id="stage-5-1-2">
			<div class="concept-title">Adding JavaScript to a Page</div>
			<div class="concept-content"><p>There are two ways:</p>
			<p>1. Put the JavaScript directly into your html file.</p>
			<p>Add the JavaScript inside of <code>&lt;script&gt;</code> tags. <a target="_blank" href="http://www.w3schools.com/js/tryit.asp?filename=tryjs_whereto_head">This example</a> shows how.</p>
			<p>2. Put the JavaScript in a separate <code>.js</code> file.</p>
			<p>This is the preferred method because it keeps your JavaScript separate from your HTML, making things cleaner, more organized and easier to edit, plus you can use the same script for many files. <a target="_blank" href="http://javascript.info/tutorial/adding-script-html#external-scripts">This tutorial</a> shows you how.</p></div>
		</div>

		<div class="concept" id="stage-5-1-3">
			<div class="concept-title">var loveJS = true;</div>
			<div class="concept-content"><p>JavaScript runs natively in the browser and allows us to run and inspect our code very easily.</p>
			<p>JavaScript gives us a way of saving data in the form of variables.</p>
			<p>The syntax looks like this: <code>var {{variableName}} = {{someValue}}</code>.</p>
			<p>To declare a new variable, you begin with the keyword <code>var</code>, regardless of the datatype you're saving.</p>
			<p>In this example, <code>var firstName = &quot;james&quot;;</code>, we're creating a variable, <code>firstName</code>, and assigning it the string <code>&quot;james&quot;</code>.</p>
			<p>Assigning variables is slightly different than in Python, which doesn't require a keyword like <code>var</code>, but otherwise looks the same.</p>
			<p>Numbers in JS don't need quotes, and you don't need to worry about the differences between floating point numbers and integers, as all numbers are saved as 64 bit floating point.</p>
			<p>Later on, we'll see that arrays, functions and objects use the same <code>var</code> syntax.</p>
			<p>Lets see if our variables are actually being saved. Add these lines to resumeBuilder.js:</p>
<pre><code>var firstName = &quot;james&quot;;
var age = 32;
console.log(firstName);</code></pre>
			<p>Then reload index.html in the browser. Open up the console. (In Chrome, its viewable via Developer Tools) <code>james</code> has printed out to the console. If the browser opens up a script with <code>console.log</code> in it, it will print whatever information it recieves to the browser console. Its very useful for debugging.</p></div>
		</div>

		<div class="concept" id="stage-5-1-4">
			<div class="concept-title">string.replace()</div>
			<div class="concept-content"><p>To build our resumes, we'll be using the <code>string.replace</code> method to find a pattern in a string to replace all or some matches of it.</p>
			<p><code>[string].replace([old], [new])</code></p>
			<p>Example:</p>
<pre><code>var email = &quot;cameron@udacity.com&quot;;
var newEmail = email.replace(&quot;udacity&quot;, &quot;gmail&quot;);
console.log(email);
console.log(newEmail);</code></pre>
			<p>With this example, you can see in the console that Cameron's old udacity email has been replaced with a gmail account.</p>
			<p>Another example using <code>.append</code> to output to the browser:</p>
<pre><code>var awesomeThoughts = &quot;I am JP and I am AWESOME!&quot;;
var funThoughts = awesomeThoughts.replace(&quot;AWESOME!&quot;, &quot;FUN&quot;);
$(&quot;#main&quot;).append(funThoughts);</code></pre></div>
		</div>

		<div class="concept" id="stage-5-1-5">
			<div class="concept-title">Mixing .replace() and .append()</div>
			<div class="concept-content"><p>HTML defines the content of a page. Now that we can replace text, we can replace text with real data, and append HTML strings to start building our resume.</p>
			<p>Lets look inside <code>helper.js</code>. It contains some helper data that your project will take advantage of. Because <code>helper.js</code> shows up in the HTML before <code>resumeBuilder.js</code>, it will load first and we'll have access to all the data from <code>helper.js</code> when we start writing <code>resumeBuilder.js</code>. In <code>helper.js</code>, we can see a few string variables, like <code>HTMLmobile</code>, <code>HTMLemail</code>, and <code>HTMLtwitter</code>. Each of them has a <code>%data%</code> placeholder. In each of those we'll be replacing <code>%data%</code> with our actual data. We'll replace <code>%data%</code> the same way we replaced AWESOME with FUN.</p>
			<p>Lets try it with the resume:</p>
<pre><code>var name = &quot;Jean-Paul Lacy&quot;;
var formattedName = HTMLheaderName.replace(&quot;%data%&quot;, name);
var role = &quot;Web Developer&quot;;
var formattedRole = HTMLheaderRole.replace(&quot;%data%&quot;, role);
$(&quot;#header&quot;).prepend(formattedRole);
$(&quot;#header&quot;).prepend(formattedName);</code></pre>
			<p>We use <code>.prepend</code> in this case because the header div in <code>index.html</code> already has content that we want to come after our name and role.</p></div>
		</div>

		<div class="concept" id="stage-5-1-6">
			<div class="concept-title">String Manipulation</div>
			<div class="concept-content"><p> Using string methods, convert &quot;audacity&quot; to &quot;Udacity&quot;. Look at the documentation on JS string methods <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">here</a>.</p>
<pre><code>var s = &quot;audacity&quot;;
var udacityizer = function(s) {
	var s = &quot;audacity&quot;;
	s = s[1].toUpperCase() + s.slice(2);
	return s;
};
console.log(udacityizer(s));</code></pre></div>
		</div>

		<div class="concept" id="stage-5-1-7">
			<div class="concept-title">Truthy/Falsy</div>
			<div class="concept-content"><p>JS has a set of values that may evaluate to true or false but may not equal true or false. Because of this, we call these values truthy and falsy.</p>
			<p><strong>Truthy:</strong></p>
			<p>true</p>
			<p>non-zero numbers</p>
			<p>&quot;strings with a length of at least one&quot;</p>
			<p>objects</p>
			<p>arrays</p>
			<p>functions</p>
			<p>(all evaluate to true)</p>
			<p><strong>Falsy:</strong></p>
			<p>false</p>
			<p>0</p>
			<p>&quot;&quot;(empty strings)</p>
			<p>undefined(The variable doesn't exist, the interpreter doesn't know what you're referring to.)</p>
			<p>null(The variable exists, but has no value.)</p>
			<p>NaN(Not a Number)</p>
			<p>(all evaluate to false)</p></div>
		</div>

		<div class="concept" id="stage-5-1-8">
			<div class="concept-title">Arrays</div>
			<div class="concept-content"><p>JS arrays are 0 index, just like lists Python. The first element is indexed to 0.</p>
			<p>Arrays are just lists of values, and the behave just like lists in Python.</p>
			<p>Syntax: <code>var myArray = [item_1, item_n]</code></p>
			<p>Lets make an array of skills, it could be useful in our resumes:</p>
			<p><code>var skills = [&quot;awesomeness&quot;, &quot;programming&quot;, &quot;teaching&quot;, &quot;JS&quot;];</code></p>
			<p>$<code>(&quot;#main&quot;).append(skills);</code></p>
			<p>Save that in <code>resumeBuilder.js</code> and refresh <code>index.html</code>. It displays, but without commas or spaces, because our strings didn't include them.</p>
			<p>Now add the line <code>$(&quot;#main&quot;).append(skills[0]);</code> to <code>resumeBuilder.js</code>. The word awesomeness gets added to what we have in the browser.</p>
			<p>If you want to just display awesomeness, comment out the first append line.</p>
			<p>Is the length of an array equal to the last index? No. Indexing starts at 0 for the first item in an array.</p></div>
		</div>

		<div class="concept" id="stage-5-1-9">
			<div class="concept-title">Array Manipulation</div>
			<div class="concept-content"><p>If you are given an array of numbers, how can you increase the value of the last number by one?</p>
<pre><code>function incrementLastArrayElement(_array)  {
	var newArray = [];
	newArray = _array.slice(0);
	var lastNumber = newArray.pop();
	newArray.push(lastNumber + 1);
	return newArray;
}</code></pre></div>
		</div>

		<div class="concept" id="stage-5-1-10">
			<div class="concept-title">Object Literal Notation</div>
			<div class="concept-content"><p>Hands are like objects because they can hold information and do things.</p>
			<p>Objects in JS can be declared and defined in a few different ways.</p>
			<p>All of them are different from the say Python defines classes and objects because there are no classes in JS. There are ways to mimic classes in some respects, but they are still just objects.</p>
			<p>Lets start defining objects with Object Literal Notation. It uses the same <code>var</code> syntax we had before:</p>
			<p><code>var myObj = {};</code></p>
			<p>Lets define an object from the biography:</p>
			<p><code>var bio = {};</code></p>
			<p>Inside the curly braces, we can define the object's properties using key value pairs:</p>
<pre><code>var bio = {
	&quot;name&quot; : &quot;James&quot;,
	&quot;age&quot; : 32
	&quot;skills&quot; : skills
};</code></pre>
			<p>We can save whatever we want here, even an array like skills.</p>
			<p>To access these properties later, we add <code>.property</code> after the object name.</p>
			<p>To append James' name to the page, all you need to do is access the <code>.name</code> property:</p>
			<p><code>$(&quot;#main&quot;).append(bio.name);</code></p></div>
		</div>

		<div class="concept" id="stage-5-1-11">
			<div class="concept-title">Dot and Bracket Notation</div>
			<div class="concept-content"><p>We just used dot notation for objects, which we just used to access <code>bio.name</code>.</p>
			<p>Dot notation allows us to define an object, then define its properties outside the curly braces:</p>
			<p><code>Syntax: var myObj = {};</code></p>
			<p><code>myObj.property = someValue;</code></p>
			<p>Example:</p>
<pre><code>var bio = {
	&quot;name&quot; : &quot;James&quot;,
	&quot;age&quot; : 32
	&quot;skills&quot; : skills
};
bio.city = &quot;Mountain View&quot;;
bio.email = &quot;james.williams@udacity.com&quot;</code></pre>
			<p>With dot notation, there is no need to use var. We're adding properties to an object, not creating new variables.</p>
			<p>There is at least one more syntax pattern to define the properties of an object: Bracket notation.</p>
			<p>Syntax: <code>myObj[&quot;property&quot;]=someValue</code></p>
			<p>Example:</p>
<pre><code>bio [&quot;city&quot;] = &quot;Mountain View&quot;;
bio [&quot;email&quot;] = &quot;james.williams@udacity.com&quot;</code></pre></div>
		</div>

		<div class="concept" id="stage-5-1-12">
			<div class="concept-title">A Note about JSON</div>
			<div class="concept-content"><p>What is JSON?</p>
			<p>JavaScript Object Notation. Its a simple format for storing and transferring nested hierarchical data. Most other programming languages have libraries to parse and write JSON. GET and POST requests often communicate using JSON. JSON allows for objects and data of other types to be enclosed in other objects.</p>
			<p>Why should I lint my JSON?</p>
			<p>JSON uses a mix of nested curly braces, brackets and commas, so its easy to make errors, creating bugs. If you're writing JSON by hand, you should run your code through a JSON linter to find syntax errors. <a target="_blank" href="http://jsonlint.com/">jsonlint.com</a> is a good one.</p>
			<p>Sublime text will highlight most syntax errors, but a JSON linter won't miss any.</p></div>
		</div>

		<div class="concept" id="stage-5-1-13">
			<div class="concept-title">JSON</div>
			<div class="concept-content"><p>JSON relies on object literal notation, useful for storing nested data.</p>
			<p>Example:</p>
<pre><code>var education = {
	&quot;schools&quot;: [
		{
		&quot;name&quot;: &quot;Eckerd College&quot;,
		&quot;city&quot;: &quot;Saint Petersburg&quot;,
		&quot;degree&quot;: &quot;BA&quot;,
		&quot;major&quot;: [&quot;CompSci&quot;, &quot;French&quot;]
		},
		{
		&quot;name&quot;: &quot;Nova Southeastern University&quot;,
		&quot;city&quot;: &quot;Fort Lauderdale&quot;,
		&quot;degree&quot;: &quot;Masters&quot;,
		&quot;major&quot;: [&quot;CompSci&quot;]
		}
	]
}</code></pre></div>
		</div>

		<div class="concept" id="stage-5-1-14">
			<div class="concept-title">Validating JSON</div>
			<div class="concept-content"><p>Open up <a target="_blank" href="http://jsonlint.com/">jsonlint.com</a> which will tell us if the above JSON is in the right format. Go ahead and copy the object above, just between the curly braces.</p>
			<p>Paste it in, click validate, and the results say Valid JSON.</p></div>
		</div>
	</div><!--lesson div-->

	<div class="lesson" id="stage-5-2">
		<h2>Stage 5.2 The Power of APIs</h2>

		<div class="concept" id="stage-5-2-1">
			<div class="concept-title">Introduction</div>
			<div class="concept-content"><p>We're going to talk about how to make your website communicate with other computers, by using what we call an API (Application Programming Interface.) Instead of generating HTML that we send to browsers, we're going to get data in formats like XML or JSON which are designed to be read by computers. In this lesson, we're going to add a feature to ASCII Chan that will allow you to see where users are submitting images from using the Google Maps API.</p></div>
		</div>

		<div class="concept" id="stage-5-2-2">
			<div class="concept-title">HTTP Clients</div>
			<div class="concept-content"><p>Until now, we've been working with the standard picture of the user, their browser, and servers. In a normal web request, the user makes a request to the server, and we respond with the response. What we're going to be talking about is when your servers make requests to other servers. We can have a web page that actually makes requests to Twitter. These are our servers talking to theirs. They're still communicating over HTTP, and Twitter still responds as usual. If we're writing a web program that does some data analysis on Twitter, a user might make a request to us, we might make a request to Twitter, they respond, we may manipulate that data and return it to the user. This is actually a really common case.</p>
			<p>Hipmunk does a lot of this. When a user does a flight search, what Hipmunk does is hit a bunch of data providers where they actually get their flight data from. Hipmunk will take your flight search, send it to ITA, send it to an airline, and in some cases, even send it to Amtrak, ITA will run their flight search and send Hipmunk data back, the airline will do the same, and Amtrak will do the same as well. On Hipmunk's server, they have all this flight search data. They will manipulate all the data, collate it, make nice results, and send back an HTML response to the user.</p>
			<p>What we're going to be working on is how do we make our server speak to other servers, when there's no browser involved. We're still using HTTP, but we are now communicating over other protocols. There are a lot of cool things you can do when you realize you aren't the only service on the internet.</p></div>
		</div>

		<div class="concept" id="stage-5-2-3">
			<div class="concept-title">Urllib</div>
			<div class="concept-content"><p>In Python we have a library called <code>urllib2</code>. (And a library called <code>urllib</code>.) Open a Python terminal and import both of those.</p>
			<p><code>urllib2</code> has a function called <code>urlopen.</code> Type this line into the terminal: <code>p = urllib2.urlopen(&quot;http://www.google.com&quot;)</code></p>
			<p>Now if we type <code>p</code> in the terminal, we get something like: <code>&lt;addinfourl at 42571208L whose fp = &lt;socket._fileobject object at 0x0000000002466B10&gt;&gt;</code></p>
			<p>This is basically a file object. In Python, a file object is an object with a <code>read</code> method. You can call <code>read</code> on it to get the contents.</p>
			<p>Type this line into the terminal: <code>c = p.read()</code></p>
			<p>Now, type in <code>c</code>. We get a wall of text. This is actually Google's front page. Now we can manipulate the response in our programs.</p>
			<p>Now, lets look at the <code>p</code> object. Type in <code>dir(p)</code>. Now we can see the methods and attributes on our <code>p</code> object.</p>
			<p>Lets look at a couple of them: Type in <code>p.url</code>. We get <code>'http://www.google.com'</code>.</p>
			<p>Type in <code>p.headers</code>. We get something like <code>&lt;httplib.HTTPMessage instance at 0x0000000002899288&gt;</code>. This is an HTTP message instance. This happens to be a dictionary. So if we type in <code>p.headers.items()</code>, we can see all the headers we got back from Google.</p></div>
		</div>

		<div class="concept" id="stage-5-2-4">
			<div class="concept-title">XML</div>
			<div class="concept-content"><p>How computers communicate:</p>
			<p>We could have our servers (say Hipmunk,) make a request to Amtrak and receive HTML back from them. But, this is sub-optimal. HTML is somewhat complex, its not very regular, browsers are forgiving of errors, and parsing HTML by machine is very difficult, so HTML is not an ideal language for computer to computer communication.</p>
			<p>One such language is XML. XML was invented in the late 90s expressly for this purpose, to have a regular way of expressing data between computer systems. XML is very similar to HTML. The main difference between XML and HTML is that every tag must have a closing tag. The tag format is the same, we still have less than and greater than surrounding tags, and slashes to indicate closing tags. There are no void tags in XML.</p></div>
		</div>

		<div class="concept" id="stage-5-2-5">
			<div class="concept-title">Parsing XML</div>
			<div class="concept-content"><p>Python has a library called <code>minidom</code>. You can get it by saying <code>from xml.dom import minidom</code>. dom stands for Document Object Model. This refers to the internal representation of an XML document. We'll be using <code>minidom</code>. Why is it called that? The mini implies that its a smaller, lighter weight version of this dom parser. When you're only parsing a little text, you can use the library <code>minidom</code>, which is simple and fast, but will break if you throw lots of gigabytes of text at it.</p>
			<p><code>minidom</code> has a function called <code>parseString: minidom.parseString</code></p>
			<p>Try entering this: <code>x = minidom.parseString(&quot;&lt;mytag&gt;contents!&lt;children&gt;&lt;item&gt;1&lt;/item&gt;&lt;item&gt;2&lt;/item&gt;&lt;/children&gt;&lt;/mytag&gt;&quot;)</code></p>
			<p>Then do <code>dir(x)</code>. We get a ton of stuff back.</p>
			<p>Try print <code>x.toprettyxml()</code>. We get a nicely formatted version of our string.</p>
			<p>Try <code>x.getElementsByTagName(&quot;mytag&quot;)</code>. We get one item.</p>
			<p>Try <code>x.getElementsByTagName(&quot;item&quot;)</code>. We get two items.</p>
			<p>We can look at the first item element by doing <code>x.getElementsByTagName(&quot;item&quot;)[0]</code></p>
			<p>If we look at its children, <code>x.getElementsByTagName(&quot;item&quot;)[0].childNodes</code>, we get <code>[&lt;DOM Text node &quot;u'1'&quot;&gt;]</code>, which means we have one text node.</p>
			<p><code>x.getElementsByTagName(&quot;item&quot;)[0].childNodes[0].nodeValue</code> accesses the node value attribute, which tells us the value is 1.</p></div>
		</div>

		<div class="concept" id="stage-5-2-6">
			<div class="concept-title">JSON</div>
			<div class="concept-content"><p>JSON serves the same purpose as XML, which is that its a nice computer and human readable way to exchange data. It stands for JavaScript Object Notation. JSON is actually valid JavaScript code. It basically looks like a dictionary:</p>
<pre><code>{&quot;itineraries&quot;: [{&quot;from&quot;: &quot;SFO&quot;,
				  &quot;to&quot;: &quot;IAD&quot;},
				 {&quot;from&quot;: &quot;IAD&quot;,
				  &quot;to&quot;: &quot;SEA&quot;}]
}</code></pre>
			<p>We have a dictionary, its got a key called itineraries, whose value may be a list of other dictionaries. In this case, we have a dictionary for each leg.</p>
			<p>JSON is really handy for expressing these types of objects. Anything you can express in XML, you can also express in JSON. JSON is a little less verbose because you don't need opening and closing tags. You can build things out of dictionaries, you can also have lists, which use brackets just like Python does, a list can also be the value of a dictionary, or an item in a list.</p>
			<p>How to parse JSON in Python:</p>
			<p>In your Python terminal <code>import json</code>.</p>
			<p>Enter this: <code>j = '{&quot;one&quot;: 1, &quot;numbers&quot;: [1,2,3.5]}</code>'</p>
			<p>Now, lets parse the string: <code>json.loads(j)</code></p>
			<p>When we run that, we get back a Python dictionary with our same keys and our same values: <code>{u'numbers': [1, 2, 3.5], u'one': 1}</code></p>
			<p>If we store that in a variable like this: <code>d = json.loads(j)</code></p>
			<p>We can manipulate it like this: <code>d['numbers']</code> gives us our list, and <code>d['one']</code> gives us our number 1.</p></div>
		</div>

		<div class="concept" id="stage-5-2-7">
			<div class="concept-title">APIs</div>
			<div class="concept-content"><p>On Reddit, we can get any page in JSON or XML by changing the extension to .json or .xml respectively. Many web pages have this feature, where you can get their content in different formats.</p>
			<p>Another good example is Twitter. If you go to Twitter and do a search for Udacity, you'll get all the different tweets about Udacity. Instead, if you go to search.twitter.com/seach.json?=udacity, you'll get a json listing of the search results we were just looking at.</p>
			<p>If you're writing web software and want to include data from other websites, it usually just takes some poking around to find their APIs.</p></div>
		</div>

		<div class="concept" id="stage-5-2-8">
			<div class="concept-title">Being a Good Citizen</div>
			<div class="concept-content"><p>How to be a good citizen on the internet:</p>
			<p>There are two key things you can do when writing software that accesses other people's websites.</p>
			<p>1. Use a good user-agent. User-agents are the header that describes the browser or software you're using to access somebody. If you're planning to access somebody in a consistent fashion, use a good user agent. When you're using <code>urllib2</code>, you can specify headers in your request, and you should set a user agent header that says who you are, what your name is, maybe links to your website, so if someone on the other end sees you pounding them, they have a way of reaching you to ask you to tone it down.</p>
			<p>2. Rate limit yourself. Instead of hammering sites for more and more results, its a good idea to get in the habit of using the <code>sleep</code> function so you aren't stressing someone's server.</p></div>
		</div>

		<div class="concept" id="stage-5-2-9">
			<div class="concept-title">SOAP</div>
			<div class="concept-content"><p>SOAP is a complicated protocol based on XML. So complicated we won't be covering it.</p>
			<p>There are many other protocols and formats for communicating across the internet:</p>
			<p>SOAP - Invented by Microsoft to make communicating across the internet as complex as possible.</p>
			<p>Protocol Buffers (Google)</p>
			<p>Thrift (Facebook)</p>
			<p>plain-text, custom formats(Not recommended, requires custom code to parse.)</p>
			<p>XML</p>
			<p>JSON</p></div>
		</div>

		<div class="concept" id="stage-5-2-10">
			<div class="concept-title">ASCII Chan 2</div>
			<div class="concept-content"><p>First, you need to download and unzip the file ascii-chan-ipnd-incomplete from <a target="_blank" href="https://www.udacity.com/course/viewer#!/c-nd000/l-4191238688/m-4080748764">here</a>, then you can follow along with the rest of the lesson.</p>
			<p>ASCII Chan is a website that allows users to submit a title along with ascii art in a message board format. Once I had it downloaded and unzipped, I loaded it in GAE so I could see it working on my machine.</p>
			<p>What we'd like to do is add a map that shows where the most recent submissions came from.</p>
			<p>We need to do several things to get this map working:</p>
			<p>We need a way to turn the request IP into coordinates.</p>
			<p>(For this we'll be using hostip.info, which has a handy API.)</p>
			<p>We need a way to draw a map.</p>
			<p>(For this we'll be using Google Maps, which has a service called static maps, which lets us draw a map with markers on it.)</p></div>
		</div>

		<div class="concept" id="stage-5-2-11">
			<div class="concept-title">Geolocation</div>
			<div class="concept-content"><p>Lets start with the first piece: Implementing a function that looks up the user's ip.</p>
			<p>Look at the code for ASCII Chan in the folder you unzipped. Its in <code>main.py</code>. Its not a lot of code, and most of it is taken up by the main page handler. The <code>get</code> function function just calls <code>render_front</code>. All <code>render_front</code> does is run a basic query to get the 10 most recent pieces of art. The <code>post</code> function grabs the title and art, and if we have both of them, creates a new art object and puts it in the database, then reloads the page by doing a redirect, otherwise it sends an error message to the user.</p>
			<p>What we're going to do, right after we create our art object is put in some comments:</p>
			<p><code># lookup the user coordinates from their IP.</code></p>
			<p><code># if we have coordinates, add them to the Art.</code></p>
			<p>We're going to need a function, we'll put it at the top just before <code>class Art</code>.</p>
<pre><code>def get_coords(ip):
	pass</code></pre>
			<p>This function will take an ip, and make a request to hostip.info, which will look like this:</p>
<pre><code>IP_URL = &quot;http://api.hostip.info/?ip=&quot;
def get_coords(ip):
	url = IP_URL + ip</code></pre>
			<p>We are going to be requesting the URL using <code>urllib2</code>, so go ahead and import that at the top of the program.</p>
			<p>We are going to be parsing the XML response using <code>minidom</code>, so go ahead and import that: from <code>xml.dom import minidom</code>.</p>
			<p>Go back to your <code>get_coords</code> function. Add some lines to store the url in a variable:</p>
<pre><code>IP_URL = &quot;http://api.hostip.info/?ip=&quot;
def get_coords(ip):
	url = IP_URL + ip
	content = None
	content = urllib2.urlopen(url)</code></pre>
			<p>Then we're going to call <code>read</code> on that response:</p>
			<p><code>content = urllib2.urlopen(url).read()</code></p>
			<p>If the URL is bad, or hostip.info is down, our code will raise an exception, so lets add code to deal with that:</p>
<pre><code>IP_URL = &quot;http://api.hostip.info/?ip=&quot;
def get_coords(ip):
	url = IP_URL + ip
	content = None
	try
		content = urllib2.urlopen(url).read()
	except URLError:
		return</code></pre>
			<p>We'll just return nothing, no coordinates. Normally, we might log this, so we can track whether or not geocoding is broken, but for our purposes we'll just return none.</p>
			<p>Next we want to check to see if there is actual content. If the website is broken it might not be giving us anything back:</p>
<pre><code>	if content:
		#parse the xml and find the coordinates
		pass</code></pre>
			<p>Now lets parse the content:</p>
<pre><code>	if content:
		d = minidom.parseString(content)
		coords = d.getElementsByTagName(&quot;gml:coordinates&quot;)
		if coords and coords[0].childNodes[0].nodeValue:
			lon, lat = coords[0].childNodes[0].nodeValue.split(',')
			return db.GeoPt(lat, lon)</code></pre>
			<p>The reason we return <code>db.GeoPt</code> is that its part of GAE, a data point for storing latitude and longitude.</p></div>
		</div>

		<div class="concept" id="stage-5-2-12">
			<div class="concept-title">Debugging</div>
			<div class="concept-content"><p>Lets test to see if our code is working. Add this line to <code>def get</code> before it calls <code>render_front():</code></p>
			<p><code>self.write(repr(get_coords(self.request.remote_addr)))</code></p>
			<p>First we call the function <code>write</code>, which outputs to the browser. Then we call <code>repr</code>. This is a handy trick for printing Python objects in HTML. When you print Python objects in HTML, it has angle brackets around them. <code>repr</code> makes them print properly. Then we call our function, <code>get_coords</code>, and call it with the requesting ip address <code>(self.request.remote_addr)</code>.</p>
			<p>When we save our code and reload the page, we see None at the top of the page. Thats better than an exception, but we didn't get a location.</p>
			<p>Lets do some investigation: First lets look at the actual ip address:</p>
<pre><code>	def get(self):
		self.write(self.request.remote_addr)
		self.write(repr(get_coords(self.request.remote_addr)))
		return self.render_front()</code></pre>
			<p>See what the browser returns now. 127.0.0.1. That means we're running this locally, so its not surprising that a service on the internet doesn't know what our local ip is. If we go to the hostip.info web page, it lists 127.0.0.1 as a private address. Every machine's local ip address is 127.0.0.1. This is called the loopback address and its how a machine refers to itself. Its not a public ip address on the internet. Localhost, which we're running our webpage on, generally refers to that ip.</p>
			<p>Lets cheat a little bit and add an ip we know is real to our code:</p>
<pre><code>def get_coords(ip):
	ip = &quot;4.2.2.2&quot;</code></pre>
			<p>We get <code>datastore_types.GeoPt(39.944, -105.062)</code> at the top.</p>
			<p>So, our <code>get_coords</code> function is working, and we tested the error case as well.</p></div>
		</div>

		<div class="concept" id="stage-5-2-13">
			<div class="concept-title">Updating the Database</div>
			<div class="concept-content"><p>Go back to def post and add in this line after <code>p = Art</code>:</p>
			<p><code>coords = get_coords(self.request.remote_addr)</code></p>
			<p>Then we said, <code># if we have coordinates, add them to the Art.</code></p>
			<p>Now, our Art object doesn't take any coordinates.</p>
			<p>So, lets add to our Art object:</p>
<pre><code>class Art(db.Model):
	title = db.StringProperty(required = True)
	art = db.TextProperty(required = True)
	created = db.DateTimeProperty(auto_now_add = True)
	coords = db.GeoPtProperty()</code></pre>
			<p>We aren't making coords required because the page already has art in it, and we don't want to wipe out our existing contributions.</p>
			<p>Now go back to the post function and replace <code># if we have coordinates, add them to the Art.</code> with:</p>
<pre><code>if coords:
	p.coords = coords</code></pre>
			<p>Now lets try submitting some art in our browser. It works, no exceptions.</p></div>
		</div>

		<div class="concept" id="stage-5-2-14">
			<div class="concept-title">Querying Coordinate Information</div>
			<div class="concept-content"><p>Here is our to do list, added to the MainPage handler:</p>
<pre><code># find which arts have coords
# if we have any arts with coords, make a map url
# display the map url</code></pre>
			<p>The first part is fairly easy: Add this line before self.render:</p>
			<p><code>points = filter(None, (a.coords for a in arts))</code></p>
			<p>To prevent the program from iterating over the database multiple times, add this line above all that:</p>
			<p><code>arts = list(arts)</code></p></div>
		</div>

		<div class="concept" id="stage-5-2-15">
			<div class="concept-title">Creating the Image URL</div>
			<div class="concept-content"><p>After the line <code>points = filter(None, (a.coords for a in arts))</code> Add this:</p>
<pre><code>img_url = None
if points:
	img_url = gmaps_img(points)</code></pre>
			<p>Now add this function above <code>get_coords</code></p>
<pre><code>GMAPS_URL = &quot;http://maps.googleapis.com/maps/api/staticmap?size=380x263&amp;sensor=false&amp;&quot;
def gmaps_img(points):
	markers = '&amp;'.join('markers=%s,%s' % p.lat, p.lon)
						for p in points)
	return GMAPS_URL + markers</code></pre>
			<p>This function takes in points, and adds them to the end of our URL as markers.</p></div>
		</div>

		<div class="concept" id="stage-5-2-16">
			<div class="concept-title">Putting it All Together</div>
			<div class="concept-content"><p>Now, we just need to display the image url.</p>
			<p>We need to pass <code>img_url</code> to our template:</p>
			<p><code>self.render('front.html', title=title, art=art, error=error, arts=arts, img_url=img_url)</code></p>
			<p>Now we need to update our template. Its called <code>front.html</code> and located in the templates directory of the project.</p>
			<p>Add these lines after the form:</p>
<pre><code>&#123;% if img_url %}
	&lt;img src=&quot;&#123;{img_url}}&quot;&gt;
&#123;% endif %}</code></pre>
			<p>Now lets try it in the browser. If we have any art with coordinates, a map will appear!</p>
			<p>To get it to appear on the right, add a class to your image in the template:</p>
<pre><code>&#123;% if img_url %}
	&lt;img class=&quot;map&quot;src=&quot;&#123;{img_url}}&quot;&gt;
&#123;% endif %}</code></pre>
			<p>Then add a style section to your template:</p>
<pre><code>&lt;style type=&quot;text/css&quot;&gt;
.map {
	position: absolute;
	right: 0;
	top: 112px;
}
&lt;/style&gt;</code></pre>
			<p>Lets try adding some more ips to see if our map works</p>
			<p><code>ip = &quot;23.24.209.141&quot;</code></p>
			<p>Submit more ascii art and see if it adds a new marker. It works!</p></div>
		</div>

		<div class="concept" id="stage-5-2-17">
			<div class="concept-title">Final Code</div>
			<div class="concept-content">Our final code for main.py looks like this:
<pre><code>import os
import re
import sys
from string import letters
import urllib2
from xml.dom import minidom
import webapp2
import jinja2

from google.appengine.ext import db

template_dir = os.path.join(os.path.dirname(__file__), 'templates')
jinja_env = jinja2.Environment(loader = jinja2.FileSystemLoader(template_dir),
	autoescape = True)

art_key = db.Key.from_path('ASCIIChan', 'arts')

def console(s):
	&quot;&quot;&quot;Writes an error message (s) to the console.&quot;&quot;&quot;
	sys.stderr.write('%s\n' % s)

console(art_key)

class Handler(webapp2.RequestHandler):
  def write(self, *a, **kw):
  	self.response.write(*a, **kw)

  def render_str(self, template, **params):
  	t = jinja_env.get_template(template)
  	return t.render(params)

  def render(self, template, **kw):
  	self.write(self.render_str(template, **kw))

GMAPS_URL = &quot;http://maps.googleapis.com/maps/api/staticmap?size=380x263&amp;sensor=false&amp;&quot;
def gmaps_img(points):
	markers = '&amp;'.join('markers=%s,%s' % (p.lat, p.lon) for p in points)
	return GMAPS_URL + markers

IP_URL = &quot;http://api.hostip.info/?ip=&quot;
def get_coords(ip):
	ip = &quot;4.2.2.2&quot;
	ip = &quot;23.24.209.141&quot;
	url = IP_URL + ip
	content = None
	try:
		content = urllib2.urlopen(url).read()
	except URLError:
		return
	if content:
		d = minidom.parseString(content)
		coords = d.getElementsByTagName(&quot;gml:coordinates&quot;)
		if coords and coords[0].childNodes[0].nodeValue:
			lon, lat = coords[0].childNodes[0].nodeValue.split(',')
			return db.GeoPt(lat, lon)

class Art(db.Model):
	title = db.StringProperty(required = True)
	art = db.TextProperty(required = True)
	created = db.DateTimeProperty(auto_now_add = True)
	coords = db.GeoPtProperty()

class MainPage(Handler):
	def render_front(self, error = '', title = '', art = ''):
		arts = db.GqlQuery(
			&quot;&quot;&quot;SELECT * FROM Art WHERE ANCESTOR IS :1 ORDER BY created DESC LIMIT 10&quot;&quot;&quot;, art_key)
		#prevent running multiple queries
		arts = list(arts)

		# find which arts have coords
		points = filter(None, (a.coords for a in arts))
		img_url = None
		if points:
			img_url = gmaps_img(points)

		#display the map url

		self.render('front.html', title=title, art=art, error=error, arts=arts, img_url=img_url)

	def get(self):
		#self.write(self.request.remote_addr)
		self.write(repr(get_coords(self.request.remote_addr)))
		return self.render_front()

	def post(self):
		title = self.request.get('title')
		art = self.request.get('art')
		if title and art:
			p = Art(parent = art_key, title=title, art=art)
			coords = get_coords(self.request.remote_addr)
			if coords:
				p.coords = coords

			p.put()
			self.redirect('/')
		else:
			error = &quot;we need both a title and some artwork!&quot;
			self.render_front(error=error, title=title, art=art, img_url=img_url)

app = webapp2.WSGIApplication([('/', MainPage)], debug = True)</code></pre></div>
		</div>
	</div><!--lesson div-->
	</div><!--stage div-->

{% endblock %}